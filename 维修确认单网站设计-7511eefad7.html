<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>维修确认单</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f5f7fa;
        }
        .form-container {
            max-width: 800px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .signature-pad {
            border: 1px dashed #d1d5db;
            background-color: #f9fafb;
        }
        .print-only {
            display: none;
        }
        @media print {
            .no-print {
                display: none;
            }
            .print-only {
                display: block;
            }
            body {
                background-color: white;
                padding: 0;
                margin: 0;
            }
            .form-container {
                box-shadow: none;
                max-width: 100%;
            }
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4">
    <div class="container mx-auto">
        <div class="form-container bg-white rounded-lg mx-auto p-8">
            <h1 class="text-2xl font-bold text-center mb-8 text-gray-800">维修确认单</h1>
            
            <div class="space-y-6">
                <!-- 客户信息 -->
                <div class="space-y-2">
                    <h2 class="text-lg font-semibold text-gray-700 border-b pb-2">客户信息</h2>
                    <div>
                        <label for="customerName" class="block text-sm font-medium text-gray-700 mb-1">客户名称</label>
                        <input type="text" id="customerName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label for="customerAddress" class="block text-sm font-medium text-gray-700 mb-1">客户地址</label>
                        <textarea id="customerAddress" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                    </div>
                </div>
                
                <!-- 维修详情 -->
                <div class="space-y-2">
                    <h2 class="text-lg font-semibold text-gray-700 border-b pb-2">维修详情</h2>
                    <div>
                        <label for="repairContent" class="block text-sm font-medium text-gray-700 mb-1">维修内容</label>
                        <textarea id="repairContent" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="repairCost" class="block text-sm font-medium text-gray-700 mb-1">维修费用</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500">¥</span>
                                </div>
                                <input type="number" id="repairCost" class="pl-8 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                        </div>
                        <div>
                            <label for="repairStatus" class="block text-sm font-medium text-gray-700 mb-1">处理结果</label>
                            <select id="repairStatus" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="" disabled selected>请选择处理结果</option>
                                <option value="已完成">已完成</option>
                                <option value="处理中">处理中</option>
                                <option value="待确认">待确认</option>
                                <option value="无法修复">无法修复</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- 客户确认 -->
                <div class="space-y-2">
                    <h2 class="text-lg font-semibold text-gray-700 border-b pb-2">客户确认</h2>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">客户签名</label>
                        <div class="signature-pad rounded-md w-full h-40 relative" id="signaturePad">
                            <canvas id="signatureCanvas" class="w-full h-full"></canvas>
                            <div id="signaturePlaceholder" class="absolute inset-0 flex items-center justify-center text-gray-400">
                                请在此处签名
                            </div>
                        </div>
                        <div class="flex justify-end mt-2">
                            <button type="button" id="clearSignature" class="text-sm text-red-600 hover:text-red-800 focus:outline-none">
                                <i class="fas fa-eraser mr-1"></i>清除签名
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 提交按钮 -->
                <div class="flex justify-center space-x-4 pt-6 no-print">
                    <button type="button" id="submitBtn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        <i class="fas fa-check-circle mr-2"></i>提交确认
                    </button>
                </div>
                
                <!-- 提交成功提示 -->
                <div id="successMessage" class="hidden p-4 bg-green-50 text-green-800 rounded-md mb-6">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        <span>维修确认单已提交成功！</span>
                    </div>
                    <div class="flex justify-center space-x-4 mt-4">
                        <button type="button" id="printBtn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            <i class="fas fa-print mr-2"></i>打印确认单
                        </button>
                    </div>
                </div>
                
                <!-- 打印页眉 -->
                <div class="print-only text-center text-xs text-gray-500 py-2 border-t mt-8">
                    维修确认单 - 打印日期: <span id="printDate"></span>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-12 text-center text-sm text-gray-500 no-print">
        <p>created by <a href="https://space.coze.cn" class="text-blue-600 hover:text-blue-800">coze space</a></p>
        <p>页面内容均由 AI 生成，仅供参考</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            const placeholder = document.getElementById('signaturePlaceholder');
            const clearBtn = document.getElementById('clearSignature');
            const submitBtn = document.getElementById('submitBtn');
            const successMessage = document.getElementById('successMessage');
            const printBtn = document.getElementById('printBtn');
            const printDate = document.getElementById('printDate');
            
            // 设置canvas尺寸
            function resizeCanvas() {
                const container = document.getElementById('signaturePad');
                canvas.width = container.offsetWidth;
                canvas.height = container.offsetHeight;
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#000';
            }
            
            // 初始化签名板
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            // 签名板事件监听
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('touchstart', startDrawing);
            
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('touchmove', draw);
            
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('touchend', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                const pos = getPosition(e);
                lastX = pos.x;
                lastY = pos.y;
                placeholder.style.display = 'none';
                e.preventDefault();
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const pos = getPosition(e);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                
                lastX = pos.x;
                lastY = pos.y;
                e.preventDefault();
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            function getPosition(e) {
                const rect = canvas.getBoundingClientRect();
                let x, y;
                
                if (e.type.includes('touch')) {
                    x = e.touches[0].clientX - rect.left;
                    y = e.touches[0].clientY - rect.top;
                } else {
                    x = e.clientX - rect.left;
                    y = e.clientY - rect.top;
                }
                
                return { x, y };
            }
            
            // 清除签名
            clearBtn.addEventListener('click', function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                placeholder.style.display = 'flex';
            });
            
            // 表单验证
            submitBtn.addEventListener('click', function() {
                const customerName = document.getElementById('customerName').value.trim();
                const customerAddress = document.getElementById('customerAddress').value.trim();
                const repairContent = document.getElementById('repairContent').value.trim();
                const repairCost = document.getElementById('repairCost').value.trim();
                const repairStatus = document.getElementById('repairStatus').value;
                const isSigned = !placeholder.style.display || placeholder.style.display === 'none';
                
                if (!customerName || !customerAddress || !repairContent || !repairCost || !repairStatus || !isSigned) {
                    alert('请填写所有必填字段并签名！');
                    return;
                }
                
                // 显示成功消息
                successMessage.classList.remove('hidden');
                
                // 设置打印日期
                const now = new Date();
                printDate.textContent = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            });
            
            // 打印功能
            printBtn.addEventListener('click', function() {
                window.print();
            });
        });
    </script>
</body>
</html>